<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Ù…Ù†Ø´Ø¦ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</title>
<style>
    body { font-family: Arial; margin: 20px; direction: rtl; }
    textarea, select, input { width: 100%; margin: 10px 0; padding: 8px; font-size: 14px; }
    button { padding: 10px; margin: 5px 0; cursor: pointer; }
    #speedInput { display: none; }
</style>
</head>
<body>

<h2>ğŸ“Œ Ù…Ù†Ø´Ø¦ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h2>

<div id="uploadSection">
    <p>ğŸ“‚ Ø§Ø±ÙØ¹ Ù…Ù„Ù CSV (Ø£ÙˆÙ„ Ù…Ø±Ø© ÙÙ‚Ø·)</p>
    <input type="file" id="csvFile" accept=".csv">
</div>

<textarea id="trackingData" placeholder="Ø£Ù„ØµÙ‚ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ Ù‡Ù†Ø§..."></textarea>

<select id="alertType">
    <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ --</option>
    <option value="Overspeed">Overspeed</option>
    <option value="External Battery Disconnected">External Battery Disconnected</option>
    <option value="Geofence Alert">Geofence Alert</option>
    <option value="Harsh Braking">Harsh Braking</option>
</select>

<input type="number" id="speedInput" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø±Ø¹Ø© (ÙƒÙ…/Ø³)">

<button id="generateAlert">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>
<textarea id="alertOutput" placeholder="Ø³ÙŠØ¸Ù‡Ø± Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ù‡Ù†Ø§..." readonly></textarea>
<button id="copyAlert">ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>

<script>
let vehicleData = {};

document.addEventListener("DOMContentLoaded", () => {
    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…Ø­ÙÙˆØ¸Ø©
    const savedData = localStorage.getItem("vehicleData");
    if (savedData) {
        vehicleData = JSON.parse(savedData);
        document.getElementById("uploadSection").style.display = "none";
    }
});

// Ø±ÙØ¹ CSV ÙˆØ­ÙØ¸Ù‡
document.getElementById("csvFile").addEventListener("change", function() {
    const file = this.files[0];
    const reader = new FileReader();
    reader.onload = function(e) {
        const lines = e.target.result.split("\n").map(l => l.trim()).filter(l => l);
        lines.shift(); // Ø­Ø°Ù Ø§Ù„Ø¹Ù†Ø§ÙˆÙŠÙ†
        lines.forEach(line => {
            const [vehicle, client] = line.split(",");
            vehicleData[vehicle.trim()] = client.trim();
        });
        localStorage.setItem("vehicleData", JSON.stringify(vehicleData));
        alert("âœ… ØªÙ… Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³ÙŠØ§Ø±Ø§Øª");
        document.getElementById("uploadSection").style.display = "none";
    };
    reader.readAsText(file);
});

// Ø¥Ø¸Ù‡Ø§Ø±/Ø¥Ø®ÙØ§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø³Ø±Ø¹Ø©
document.getElementById("alertType").addEventListener("change", function() {
    document.getElementById("speedInput").style.display = this.value === "Overspeed" ? "block" : "none";
});

// Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
document.getElementById("generateAlert").addEventListener("click", () => {
    const rawText = document.getElementById("trackingData").value;
    const alertType = document.getElementById("alertType").value;
    const speed = document.getElementById("speedInput").value;
    if (!rawText || !alertType) return alert("âš ï¸ Ø£Ø¯Ø®Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡");

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„Ø³ÙŠØ§Ø±Ø© (Ø£ÙˆÙ„ ÙƒÙ„Ù…Ø© Ø£Ùˆ Ø¬Ù…Ù„Ø© Ù‚Ø¨Ù„ Address)
    const vehicleMatch = rawText.split(" Address")[0].trim();
    const company = vehicleData[vehicleMatch] || "Unknown Company";

    // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª
    const latMatch = rawText.match(/Latitude:\s*([\d\.\-]+)/);
    const lonMatch = rawText.match(/Longitude:\s*([\d\.\-]+)/);
    const locationName = rawText.match(/Address:\s*(.+?) Street view:/)?.[1]?.trim() || "Unknown Location";

    const lat = latMatch ? latMatch[1] : "";
    const lon = lonMatch ? lonMatch[1] : "";

    // Ø¨Ù†Ø§Ø¡ Ù†Øµ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
    let alertMsg = `Hello, your vehicle has an event,\n${company} ${vehicleMatch} ${alertType}`;
    if (alertType === "Overspeed" && speed) {
        alertMsg += ` (${speed} km/h)`;
    }
    alertMsg += `\n(${locationName})\nhttps://www.google.com/maps?q=${lat},${lon}&t=m&hl=en\n\nClicklife GPS System`;

    document.getElementById("alertOutput").value = alertMsg;
});

// Ù†Ø³Ø® Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡
document.getElementById("copyAlert").addEventListener("click", () => {
    const alertText = document.getElementById("alertOutput").value;
    navigator.clipboard.writeText(alertText).then(() => {
        alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡");
    });
});
</script>

</body>
</html>
