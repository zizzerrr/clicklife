<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>Clicklife Quick Alert</title>
<style>
    body {font-family: Arial, sans-serif; direction: rtl; background:#222; color:#fff; padding:20px;}
    textarea, select, button {width:100%; margin:10px 0; padding:10px; font-size:16px; border-radius:6px; border:none;}
    textarea {height:150px;}
    select, button {cursor:pointer;}
    button {background:#ffd54f; font-weight:bold;}
    button:hover {background:#ffca28;}
    #alertBox {background:#fff; color:#000; padding:15px; border-radius:6px; margin-top:15px; white-space:pre-wrap;}
</style>
</head>
<body>

<h2>إنشاء تنبيه بسرعة</h2>

<label>ألزق هنا بيانات التتبع:</label>
<textarea id="trackingData" placeholder="ألزق هنا النص من نظام التتبع..."></textarea>

<label>نوع التنبيه:</label>
<select id="alertType">
    <option value="">اختر نوع التنبيه</option>
    <option value="Overspeed">Overspeed</option>
    <option value="External Battery Disconnected">External Battery Disconnected</option>
    <option value="Towing">Towing</option>
    <option value="Geofence">Geofence</option>
</select>

<button id="generateBtn">إنشاء التنبيه</button>
<button id="copyBtn" style="display:none;">نسخ التنبيه</button>

<div id="alertBox" style="display:none;"></div>

<script>
document.getElementById("generateBtn").addEventListener("click", function(){
    const text = document.getElementById("trackingData").value;
    const alertType = document.getElementById("alertType").value;
    if(!text || !alertType){
        alert("يرجى إدخال بيانات التتبع واختيار نوع التنبيه");
        return;
    }

    // استخراج البيانات باستخدام regex
    const carMatch = text.match(/^[A-Z0-9\-]+/i);
    const addressMatch = text.match(/Address:\s*([^S]+)/i);
    const latMatch = text.match(/Latitude:\s*([0-9\.\-]+)/i);
    const lonMatch = text.match(/Longitude:\s*([0-9\.\-]+)/i);

    if(!carMatch || !latMatch || !lonMatch){
        alert("تعذر استخراج البيانات من النص، تأكد من الصيغة");
        return;
    }

    const carNumber = carMatch[0];
    const company = "Clicklife"; // ممكن تعدل لو عندك شركات مختلفة
    const locationName = addressMatch ? addressMatch[1].trim() : "";

    let msg = `Hello, your vehicle has an event,\n${company} ${carNumber}`;

    switch (alertType) {
        case "Overspeed": msg += ` was Over Speed`; break;
        case "External Battery Disconnected": msg += ` External Battery Disconnected`; break;
        case "Towing": msg += ` is on recovery`; break;
        case "Geofence": msg += ` was Stop In Geofence`; break;
    }

    if (locationName) {
        msg += ` (${locationName})`;
    }

    msg += `\nhttps://www.google.com/maps?q=${latMatch[1]},${lonMatch[1]}&t=m&hl=en`;
    msg += `\n\nClicklife GPS System`;

    document.getElementById("alertBox").textContent = msg;
    document.getElementById("alertBox").style.display = "block";
    document.getElementById("copyBtn").style.display = "block";
});

document.getElementById("copyBtn").addEventListener("click", function(){
    navigator.clipboard.writeText(document.getElementById("alertBox").textContent)
        .then(()=>alert("تم نسخ التنبيه!"))
        .catch(()=>alert("فشل النسخ"));
});
</script>

</body>
</html>
