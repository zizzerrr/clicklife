<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</title>
<style>
    body { font-family: Arial, sans-serif; background: #f4f4f4; text-align: center; direction: rtl; }
    .container { background: white; padding: 20px; margin: 20px auto; width: 90%; max-width: 600px; border-radius: 10px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    textarea, select, input { width: 100%; padding: 8px; margin: 5px 0 15px; border-radius: 5px; border: 1px solid #ccc; }
    button { padding: 10px 15px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
    #generateAlert { background: #28a745; color: white; }
    #copyAlert { background: #007bff; color: white; }
    .hidden { display: none; }
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
<div class="container">
    <h1>ğŸ“¢ Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡Ø§Øª</h1>
    
    <label>ğŸ“‚ Ø§Ø±ÙØ¹ Ù…Ù„Ù Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø©):</label>
    <input type="file" id="fileInput" accept=".xlsx">
    <p id="status">Ù„Ù… ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ø¹Ø¯</p>

    <label>ğŸ“„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹:</label>
    <textarea id="trackingData" placeholder="Ø£Ù„ØµÙ‚ Ù‡Ù†Ø§ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹"></textarea>

    <label>ğŸš¨ Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡:</label>
    <select id="alertType">
        <option value="">-- Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ --</option>
        <option value="Overspeed">ØªØ¬Ø§ÙˆØ² Ø§Ù„Ø³Ø±Ø¹Ø©</option>
        <option value="Stop">ØªÙˆÙ‚Ù</option>
        <option value="Geofence">Ø®Ø±ÙˆØ¬ Ù…Ù† Ù…Ù†Ø·Ù‚Ø©</option>
    </select>

    <div id="speedInput" class="hidden">
        <label>âš¡ Ø§Ù„Ø³Ø±Ø¹Ø©:</label>
        <input type="number" id="speedValue" placeholder="Ø£Ø¯Ø®Ù„ Ø§Ù„Ø³Ø±Ø¹Ø© ÙƒÙ…/Ø³">
    </div>

    <button id="generateAlert">Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>
    <button id="copyAlert" class="hidden">Ù†Ø³Ø® Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡</button>

    <label>ğŸ“¢ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ:</label>
    <textarea id="alertOutput" readonly></textarea>
</div>

<script>
let vehicleData = {};

document.getElementById("fileInput").addEventListener("change", function(e) {
    let file = e.target.files[0];
    if (!file) return;
    let reader = new FileReader();
    reader.onload = function(e) {
        let data = new Uint8Array(e.target.result);
        let workbook = XLSX.read(data, { type: "array" });
        let sheetName = workbook.SheetNames[0];
        let sheet = XLSX.utils.sheet_to_json(workbook.Sheets[sheetName]);
        vehicleData = {};
        sheet.forEach(row => {
            if (row.Vehicle && row.Client) {
                vehicleData[row.Vehicle.trim()] = row.Client.trim();
            }
        });
        document.getElementById("status").textContent = "âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­";
    };
    reader.readAsArrayBuffer(file);
});

document.getElementById("alertType").addEventListener("change", function() {
    document.getElementById("speedInput").classList.toggle("hidden", this.value !== "Overspeed");
});

document.getElementById("generateAlert").addEventListener("click", function() {
    let trackingText = document.getElementById("trackingData").value;
    let alertType = document.getElementById("alertType").value;
    let speed = document.getElementById("speedValue").value;

    if (!trackingText || !alertType) {
        alert("âš  ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØªØ¨Ø¹ ÙˆØ§Ø®ØªÙŠØ§Ø± Ù†ÙˆØ¹ Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡");
        return;
    }

    let vehicleMatch = trackingText.split(/\s+/).slice(0, 3).join(" ");
    let clientName = vehicleData[vehicleMatch] || "ğŸš« ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ";

    let alertMsg = `ØªÙ†Ø¨ÙŠÙ‡: ${alertType}\nØ§Ù„Ù…Ø±ÙƒØ¨Ø©: ${vehicleMatch}\nØ§Ù„Ø´Ø±ÙƒØ©: ${clientName}`;
    if (alertType === "Overspeed") {
        alertMsg += `\nØ§Ù„Ø³Ø±Ø¹Ø©: ${speed} ÙƒÙ…/Ø³`;
    }

    document.getElementById("alertOutput").value = alertMsg;
    document.getElementById("copyAlert").classList.remove("hidden");
});

document.getElementById("copyAlert").addEventListener("click", function() {
    let output = document.getElementById("alertOutput");
    output.select();
    document.execCommand("copy");
    alert("âœ… ØªÙ… Ù†Ø³Ø® Ø§Ù„ØªÙ†Ø¨ÙŠÙ‡");
});
</script>
</body>
</html>
