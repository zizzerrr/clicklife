<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>أليرت سيارة بسيط مع السرعة</title>
    <style>
        body { font-family: Tahoma, Arial, sans-serif; background:#f7f7fa; }
        .container { width:95%; max-width:420px; margin:40px auto; background:#fff; border-radius:8px; box-shadow:0 3px 20px #0002; padding:24px;}
        textarea,input,select,button{width:100%;margin:8px 0;padding:8px;border-radius:6px;border:1px solid #bbb;}
        textarea{height:90px;}
        #alertOutput{height:120px;}
        .row{margin-bottom:15px;}
        .label{font-weight:bold;}
        .hint{color:#888; font-size:0.96em;}
    </style>
</head>
<body>
<div class="container">
    <h2>🚗 أليرت سيارة بسيط مع السرعة</h2>
    <div class="row">
        <div class="label">بيانات التتبع:</div>
        <textarea id="trackingData" placeholder="ألصق بيانات التتبع هنا"></textarea>
    </div>
    <div class="row">
        <div class="label">نوع التنبيه:</div>
        <select id="alertType">
            <option value="">-- اختر نوع التنبيه --</option>
            <option value="towing">Towing</option>
            <option value="external battery disconnected">External Battery Disconnected</option>
            <option value="overspeed">Overspeed</option>
            <option value="stop for 10 day">Stop for 10 Day</option>
            <option value="stop in geofence">Stop in Geofence</option>
        </select>
    </div>
    <button onclick="generateAlert()">✨ إنشاء التنبيه</button>
    <button onclick="copyAlert()" id="copyBtn" style="display:none">📋 نسخ التنبيه</button>
    <div class="row">
        <div class="label">النتيجة:</div>
        <textarea id="alertOutput" readonly></textarea>
    </div>
</div>
<script>
function generateAlert() {
    let tracking = document.getElementById('trackingData').value;
    let alertType = document.getElementById('alertType').value;
    if (!tracking || !alertType) { alert('اكتب بيانات التتبع واختر نوع التنبيه'); return; }
    // استخراج رقم السيارة (أول كلمة قبل Address غالبًا)
    let addressIdx = tracking.indexOf("Address:");
    let vehicleLine = (addressIdx !== -1) ? tracking.substring(0, addressIdx).replace(/\n/g,"").trim() : tracking.split('\n')[0];
    let plateMatch = vehicleLine.match(/^[^\s]+/);
    let plate = plateMatch ? plateMatch[0] : vehicleLine.split(/\s+/)[0] || "";
    let modelColor = vehicleLine.replace(plate, '').trim();
    // باقي البيانات
    let addressMatch = tracking.match(/Address:\s*(.+)/);
    let address = addressMatch ? addressMatch[1].trim() : "";
    let latMatch = tracking.match(/Latitude:\s*([0-9\.\-]+)/);
    let lngMatch = tracking.match(/Longitude:\s*([0-9\.\-]+)/);
    let latitude = latMatch ? latMatch[1] : "";
    let longitude = lngMatch ? lngMatch[1] : "";
    // السرعة لو اوفر سبيد
    let typeText = "";
    if(alertType === "overspeed") {
        let speedMatch = tracking.match(/Speed:\s*([0-9\.]+)\s*kph?/i);
        let speed = speedMatch ? speedMatch[1] : "";
        typeText = speed ? `is overspeeding ${speed} kph` : "is overspeeding";
    } else {
        switch (alertType) {
            case "towing": typeText = "is on recovery"; break;
            case "external battery disconnected": typeText = "has external battery disconnected"; break;
            case "stop for 10 day": typeText = "has stopped for 10 days"; break;
            case "stop in geofence": typeText = "has stopped in geofence"; break;
            default: typeText = "has an event";
        }
    }
    let vehicleDesc = plate + (modelColor ? ' ' + modelColor : '');
    let msg = [
        `Hello, your vehicle has an event,`,
        `${vehicleDesc} ${typeText} (${address})`,
        (latitude && longitude) ? `https://www.google.com/maps?q=${latitude},${longitude}&t=m&hl=en` : '',
        "Clicklife GPS System"
    ].filter(Boolean).join('\n\n');
    document.getElementById('alertOutput').value = msg;
    document.getElementById('copyBtn').style.display = 'inline-block';
}
function copyAlert() {
    let output = document.getElementById('alertOutput');
    output.select();
    document.execCommand("copy");
    document.getElementById('copyBtn').textContent = "✅ تم النسخ!";
    setTimeout(()=>{document.getElementById('copyBtn').textContent = "📋 نسخ التنبيه";}, 1200);
}
</script>
</body>
</html>
